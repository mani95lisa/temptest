(function(){"use strict";define(["console","humane","moment"],function(e,t,n){return function(n,r,i,s,o,u,a,f){var l,c,h,p,d;return e.group("collection_check"),n.checking=f.getCheck(),n.checking?(n.info="名称："+n.checking.name,e.log(n.checking),n.requesting=!1,p=$("#player"),n.externalScopes={edit:function(t){var n;return n=s.open({templateUrl:"modals/edit_collection.html",controller:"EditCollection",backdrop:"static",resolve:{data:function(){return t.entity}}}),n.result.then(function(t){return e.log(t)},function(){return e.log("dismiss")})},cache:function(e){if(n.requesting)return;n.requesting=!0;if(caching.indexOf(e.entity)===-1||e.entity.cache_status==="缓存失败")return r.get("/m/cache",{params:{id:e.entity._id}}).success(function(r){return r.err?t.log(err):(e.entity.cache_status="开始缓存",caching.push(e.entity),t.log("开始缓存")),n.requesting=!1}).error(function(e){return e&&t.log(e),n.requesting=!1})},check:function(e){},cacheLabel:function(e){return"缓存"},style:function(e){return"btn btn-warn btn-flat btn-sm"},"try":function(e){var t;return t=host+e.entity.content.url,p.prop("src",t),!0}},c='<div style="text-align: center"><div class="btn-group" ng-disabled="getExternalScopes().requesting"> <button ng-click="getExternalScopes().edit(row)" class="btn btn-default btn-flat btn-sm">编辑</button> <button ng-click="getExternalScopes().try(row)" class="btn btn-default btn-flat btn-sm">试听</button> <button class="btn btn-warning btn-flat btn-sm">移除</button> </div></div>',n.gridOptions2={columnDefs:[{name:"序号",field:"index",enableCellEdit:!0,type:"number"},{name:"名称",field:"content.name",enableSorting:!1},{name:"大小",field:"getSize()",enableSorting:!1},{name:"时长",field:"getTime()",enableSorting:!1},{name:"操作",width:200,cellTemplate:c,enableSorting:!1}]},l=n.checking,h=l.length,d=l.cache_url,e.log("contents:",l.contents),l.contents&&l.contents.forEach(function(e){return e.getSize=function(){return bytesToSize(e.content.size)},e.getTime=function(){return getTime(e.content.duration)}}),e.log("set contents2"),n.gridOptions2.data=l.contents,n.$apply(),n.back=function(){return u.path("collection")},n.save=function(){},e.groupEnd()):a(function(){return u.path("collection")},1e3)}})}).call(this);