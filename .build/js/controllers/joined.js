(function(){"use strict";define(["console","humane","moment"],function(e,t,n){return function(r,i,s,o,u,a){var f,l,c;return e.group("joined"),r.page=1,r.search=function(){return r.page=1,r.getData()},r.pageSize=10,r.pages=[10,25,50,100],r.footer="partials/grid/grid_footer.html",r.header="partials/grid/grid_header.html",r.filters=["所有","未中奖","已中奖","已派奖"],r.searchTip="请输入7位抽奖号或11位用户手机号或抽奖活动标题",r.filter={value:"所有"},r.$watch("filter.value",function(e){return r.getData()}),r.$watch("pageSize",function(e){return r.getData()}),r.$watch("page",function(e){return r.getData()}),r.$watch("category.value",function(e){return r.getData()}),f=[],r.requesting=!1,l=function(n){var s;return s=o.open({templateUrl:"modals/joined.html",controller:"EditJoined",backdrop:"static",resolve:{data:function(){return n.entity}}}),s.result.then(function(n){return n._csrf=csrf,i.post("/lottery_records/update",n).success(function(n){return n.err?t.log(n.err):(t.log("更新成功"),e.log(n),r.getData())})},function(){return e.log("dismiss")})},r.externalScopes={edit:function(e){return l(e)},enable:function(n){var s;return s=n.entity,s.enabled=!s.enabled,e.log(s.enabled),s._csrf=csrf,i.post("/lottery_records/update",s).success(function(n){return n.err?t.error(n.err):(t.log("更新成功"),e.log(n),r.getData())})}},c='<div style="text-align: left"><div class="btn-group" ng-disabled="getExternalScopes().requesting"> <button ng-click="getExternalScopes().edit(row)" class="btn btn-default btn-flat btn-sm">编辑</button> </div></div>',r.gridOptions={enableSorting:!1,columnDefs:[{name:"用户手机号",field:"mobile",enableSorting:!1},{name:"用户姓名",field:"truename",enableSorting:!1},{name:"中奖奖品",field:"lottery",enableSorting:!1},{name:"邮箱地址",field:"email",enableSorting:!1},{name:"日期",field:"created_at",enableSorting:!1}]},r.getData=function(){var s,o;if(r.requesting)return;return r.requesting=!0,e.log(r.filter,r.category),o=r.filters.indexOf(r.filter.value),r.category&&(s=r.category.value),i.get("/lottery_records/list",{params:{category:s,filter:o,page:r.page,pageSize:r.pageSize,keywords:r.keywords}}).success(function(i){return e.group("lottery_records"),e.log("GotLotteryRecords",i),e.groupEnd(),r.requesting=!1,i.err?t.log(i.err):(r.count=i.count,i.result&&i.result.forEach(function(e){var t;return t=["黄金BB正品","春漾优雅大拎包","春漾遮阳伞","春漾闪耀长方巾"],e.lottery=t[parseInt(e.lottery)],e.created_at=n(e.created_at).format("MM-DD HH:mm:ss")}),r.gridOptions.data=i.result)}).error(function(e){r.requesting=!1;if(e)return t.log(e)})},r.getData(),e.groupEnd()}})}).call(this);